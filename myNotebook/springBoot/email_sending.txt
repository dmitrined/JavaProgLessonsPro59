### Отправка E-mail в Spring Boot

#### 1. Назначение
E-mail в backend-приложениях используется для уведомлений, подтверждений действий (регистрация, заказ) и восстановления доступа. Это внешняя интеграция, которая требует изоляции логики, обработки ошибок и логирования.

#### 2. Протокол SMTP
*   **SMTP (Simple Mail Transfer Protocol)** — основной протокол передачи почты.
*   Spring Boot выступает в роли **SMTP-клиента**, подключаясь к внешнему SMTP-серверу для отправки писем.

#### 3. JavaMailSender
Основной интерфейс в Spring Boot для работы с почтой.
*   Автоматически настраивается через `application.properties`.
*   Инкапсулирует детали подключения к SMTP.

#### 4. Архитектурный подход (@Service)
Отправка писем — это побочный эффект и внешняя интеграция, поэтому она должна быть вынесена в **Service-слой**.
*   **Контроллер:** принимает запрос, валидирует DTO, вызывает сервис.
*   **Сервис:** содержит бизнес-логику формирования и отправки письма.

#### 5. Формат письма: Plain Text vs HTML
В современных проектах стандартом является **HTML**, так как он позволяет использовать форматирование, стили и кнопки.

#### 6. Шаблонизатор Thymeleaf
Используется для отделения HTML-разметки от Java-кода.
*   **Процесс:** Java передает данные (Context) -> Thymeleaf подставляет их в HTML-шаблон -> генерируется готовое письмо.
*   Позволяет легко поддерживать и изменять дизайн писем без правки кода.

#### 7. MIME и MimeMessageHelper
Для отправки HTML-писем и вложений используется **MIME** (Multipurpose Internet Mail Extensions).
*   `MimeMessage` — объект письма с поддержкой HTML и вложений.
*   `MimeMessageHelper` — вспомогательный класс для удобной настройки `MimeMessage`.

#### 8. Логирование и Обработка ошибок
Взаимодействие с внешним миром (SMTP) всегда сопряжено с рисками (таймауты, ошибки аутентификации). 
*   **Обязательно:** логировать факт отправки (INFO) и возникающие ошибки (ERROR).

#### 9. DTO vs Entity
Для Email-API всегда используются **DTO**, а не Entity. Это защищает модель базы данных и обеспечивает стабильность API при изменениях в структуре данных.

#### 10. Тестирование
В тестах не следует отправлять реальные письма. Используются "фейковые" SMTP-серверы или заглушки (Mocks), чтобы проверить сам факт вызова метода отправки.

#### 11. Общая схема работы
1. `Controller` принимает запрос.
2. Валидация `DTO`.
3. `Service` собирает данные, заполняет `Context` для Thymeleaf.
4. Генерация HTML из шаблона.
5. Отправка через `JavaMailSender` (MimeMessage).
6. Логирование результата.
7. Возврат ответа клиенту.
